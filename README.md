# mo3ta-coverage

**mo3ta-coverage** is a CLI tool for checking test coverage of changed lines in a pull request. It runs related tests, parses coverage reports, and ensures cumulative coverage meets a specified thresholdâ€”ideal for CI and code review workflows.

## Features

- Detects changed files between branches
- Runs related Jest tests
- Parses `lcov.info` for coverage data
- Reports uncovered changed lines
- Checks overall coverage against a limit

## Usage

```sh
mo3ta-coverage --base origin/main --lcov coverage/lcov.info --limit 80
```

## CLI Options

| Option         | Description                                                      | Default            |
|----------------|------------------------------------------------------------------|--------------------|
| `--base`       | Base branch to compare against                                   | `origin/main`      |
| `--lcov`       | Path to lcov.info file generated by test coverage tools          | `coverage/lcov.info`|
| `--limit`      | Minimum required coverage percentage for all changed lines       | `80`               |

## Architecture Diagram

```mermaid
flowchart TD
    A[User runs mo3ta-coverage] --> B[Parse CLI options]
    B --> C[Get changed files via git diff]
    C --> D[Run related Jest tests]
    D --> E[Parse lcov.info for coverage]
    E --> F[Report uncovered changed lines]
    F --> G[Check overall coverage vs limit]
```

## Flow

1. **Parse CLI options** using [commander](https://www.npmjs.com/package/commander).
2. **Get changed files**: Uses `git diff` to find modified JS/TS files.
3. **Run related tests**: Executes Jest for changed files.
4. **Parse coverage**: Reads `lcov.info` to find uncovered lines.
5. **Report**: Prints uncovered changed lines and overall coverage.
6. **Enforce limit**: Exits with error if coverage is below the specified threshold.

## Example Output

```
Options: Base Branch: origin/main 
LCOV Path: coverage/lcov.info 
Coverage Limit: 80
ðŸ§ª Running tests related to changed files:
src/foo.js
src/bar.js
ðŸš¨ src/foo.js - Uncovered changed lines: [12, 15]
âœ… src/bar.js - All changed lines are covered
ðŸ”¢ Overall coverage for all changed lines: 85.71%
   âœ… Overall coverage meets the limit with value: 85.71%
```

## License

MIT