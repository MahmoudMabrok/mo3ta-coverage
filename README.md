# mo3ta-coverage

**mo3ta-coverage** is a [CLI tool](https://www.npmjs.com/package/mo3ta-coverage) for checking test coverage of changed lines in a pull request. It runs related tests, parses coverage reports, and ensures cumulative coverage meets a specified thresholdâ€”ideal for CI and code review workflows.

## Features

- Detects changed files between branches using `git diff`
- Runs related Jest tests for changed files
- Parses `lcov.info` for coverage data
- Reports uncovered changed lines
- Optionally displays covered changed lines
- Checks overall coverage against a user-defined limit

## Usage

```sh
mo3ta-coverage
```

## CLI Options

| Option           | Description                                                      | Default              |
|------------------|------------------------------------------------------------------|----------------------|
| `--base`         | Base branch to compare against                                   | `origin/main`        |
| `--lcov`         | Path to lcov.info file generated by test coverage tools          | `coverage/lcov.info` |
| `--limit`        | Minimum required coverage percentage for all changed lines       | `80`                 |
| `--showCovered`  | Show covered changed lines in the output                         | `false`              |
| `--shallow`  | Run test files only, skipping other files                         | `true`              |

## How It Works

1. **Parse CLI options** using [commander](https://www.npmjs.com/package/commander) in [`index.js`](index.js).
2. **Get changed files**: Uses `git diff --name-only <base>` to find modified JS/TS files ([`src/cli.js`](src/cli.js)).
3. **Run related tests**: Executes Jest for changed files with `--findRelatedTests` ([`src/cli.js`](src/cli.js)).
4. **Parse coverage**: Reads `lcov.info` to find uncovered lines ([`src/cli.js`](src/cli.js)).
5. **Report**: Prints uncovered changed lines, optionally covered lines, and overall coverage ([`src/cli.js`](src/cli.js)).
6. **Enforce limit**: Exits with error if coverage is below the specified threshold.


# mo3ta-coverage

Run tests and report uncovered changed lines in a PR. Checks cumulative coverage for all changed lines against a specified limit. Useful for CI and code review workflows.

## Installation

```sh
npm install -g mo3ta-coverage
```

## Full Usage

```sh
--base origin/master --lcov coverage/lcov.info --limit 80 --showCovered --shallow=false
```

### Options
- `--base <branch>`: Base branch to compare against (default: origin/main or config value)
- `--lcov <path>`: Path to lcov.info file generated by test coverage tools (default: coverage/lcov.info)
- `--limit <percent>`: Minimum required coverage percentage for all changed lines (default: 80)
- `--showCovered`: Show covered changed lines in the output
- `--shallowTests`: Run test files only without deep in tests tree

## Configuration

You can persist default options using the config command:

```sh
mo3ta-coverage config --base origin/dev --shallow false
```

This will save your preferences in `.mo3ta-coverage.json` in your project root. The CLI will use these values unless overridden by command-line options.

## Development

1. Clone the repository
2. Install dependencies:
   ```sh
   npm install
   ```
3. Run tests:
   ```sh
   npm test
   ```
4. Run tests with coverage:
   ```sh
   npm run test:coverage
   ```

## License
MIT
